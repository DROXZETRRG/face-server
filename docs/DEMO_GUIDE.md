# 人脸识别演示系统使用指南

## 📋 功能概览

已成功部署人脸识别演示系统，包含以下功能：

### ✅ 已实现功能

1. **增强的 Swagger 文档**
   - 详细的 API 说明和标签分类
   - 健康检查、应用管理、人脸管理、WebSocket 分类
   - 访问地址: http://localhost:8000/docs

2. **完整的演示页面**
   - 人脸注册和删除
   - 实时摄像头检测
   - WebSocket 连接
   - 采样频率控制
   - 访问地址: http://localhost:8000/static/demo.html

3. **WebSocket 实时检测**
   - 摄像头实时人脸检测
   - 可配置采样频率（100ms - 2000ms）
   - 可调节识别阈值（0.3 - 0.9）
   - 实时绘制检测框和标签

## 🚀 快速开始

### 1. 访问演示页面

```
http://localhost:8000/static/demo.html
```

### 2. 创建应用

点击"创建新应用"按钮，系统会自动生成一个应用 ID 并保存。

### 3. 注册人脸

1. 输入人员 ID（如：person_001）
2. 选择人脸图片文件
3. 点击"📸 注册人脸"

### 4. 启动实时检测

1. 调整采样频率（默认 500ms）
2. 调整识别阈值（默认 0.6）
3. 点击"🎥 启动摄像头"
4. 允许浏览器访问摄像头
5. 系统会自动检测并识别人脸

### 5. 查看结果

- 检测框会实时显示在视频上
- 匹配的人脸显示绿色框和人员 ID
- 未匹配的人脸显示橙色框
- 右侧结果面板显示详细信息

## 📊 API 文档

### Swagger UI
```
http://localhost:8000/docs
```

功能特性：
- 完整的 API 接口文档
- 在线测试功能
- 请求/响应示例
- Schema 定义

### ReDoc
```
http://localhost:8000/redoc
```

## 🎮 控制说明

### 采样频率控制

- **范围**: 100ms - 2000ms
- **默认**: 500ms
- **说明**: 控制多久发送一帧图像进行检测
  - 低频率（100-300ms）: 检测更频繁，CPU占用高
  -中频率（400-700ms）: 平衡性能和响应
  -高频率（800-2000ms）: 省资源，响应稍慢

### 识别阈值控制

- **范围**: 0.3 - 0.9
- **默认**: 0.6
- **说明**: 控制人脸匹配的严格程度
  - 低阈值（0.3-0.5）: 更容易匹配，可能误报
  - 中阈值（0.6-0.7）: 平衡准确率和召回率
  - 高阈值（0.8-0.9）: 严格匹配，可能漏报

## 🔌 WebSocket API

### 连接地址
```
ws://localhost:8000/ws/detect?app_id=<APP_ID>&threshold=<THRESHOLD>
```

### 请求格式
```json
{
    "image": "base64_encoded_image",
    "threshold": 0.6
}
```

### 响应格式
```json
{
    "face_count": 1,
    "faces": [
        {
            "bbox": [100, 50, 300, 250],
            "confidence": 0.95,
            "match": true,
            "person_id": "person_001",
            "similarity": 0.87,
            "face_id": "uuid"
        }
    ],
    "processing_time": 0.123
}
```

## 📸 截图示例

### 演示页面布局

```
┌─────────────────────────────────────────────┐
│         人脸识别演示系统                        │
├──────────────────┬─────────────────────────┤
│ 👤 人脸管理        │  📹 实时人脸检测            │
│                  │                         │
│ 应用ID配置         │  [视频画面]              │
│ 人员ID输入         │                         │
│ 图片上传          │  采样频率: 500ms          │
│ 📸 注册人脸        │  识别阈值: 0.60           │
│                  │                         │
│ 已注册人脸列表:     │  🎥 启动摄像头            │
│ • person_001     │  ⏹️ 停止检测              │
│   [🗑️ 删除]       │                         │
│ • person_002     │  检测结果:                │
│   [🗑️ 删除]       │  • person_001 (87%)     │
│                  │  • 未知人脸                │
└──────────────────┴─────────────────────────┘
```

## 🛠️ 技术细节

### 性能优化

1. **帧采样控制**: 避免过度频繁的检测
2. **WebSocket 连接**: 减少 HTTP 开销
3. **Canvas 绘制**: 实时可视化检测结果
4. **Base64 编码**: 高效的图像传输

### 浏览器兼容性

- ✅ Chrome/Edge (推荐)
- ✅ Firefox
- ✅ Safari
- ⚠️ 需要 HTTPS 或 localhost 访问摄像头

## 🐛 故障排查

### 摄像头无法启动

1. 检查浏览器权限
2. 确认使用 HTTPS 或 localhost
3. 查看浏览器控制台错误

### WebSocket 连接失败

1. 确认应用 ID 已创建
2. 检查服务器是否运行
3. 查看网络请求状态

### 识别效果不佳

1. 提高采样频率获取更多帧
2. 调整识别阈值
3. 确保光线充足
4. 人脸正对摄像头

## 📚 相关文档

- [InsightFace 使用指南](./INSIGHTFACE_GUIDE.md)
- [API 接口文档](http://localhost:8000/docs)
- [项目状态](../PROJECT_STATUS.md)

## 🎯 下一步

1. 体验演示页面的所有功能
2. 查看 Swagger 文档了解 API 详情
3. 集成 WebSocket 到你的应用
4. 根据需求调整参数优化性能

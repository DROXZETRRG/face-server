## 人脸识别服务器


### 概述
人脸识别服务器用于处理人脸识别相关的请求，提供人脸检测、人脸比对和人脸特征提取等功能。该服务器基于深度学习技术，能够高效、准确地完成各类人脸识别任务，广泛应用于安防、金融、社交等领域。



### 技术选型
- Python 3.8+ 
- uv 环境管理工具
- FastAPI 框架
- PostgreSQL + pg_vector 作为数据库存储人脸特征向量
- Docker 容器化部署 + docker compose 编排
- 人脸识别模型：InsightFace
- 异步任务处理：Celery + Redis



### 模块设计

#### 人脸检测模块
负责从输入图像中检测出人脸位置，返回多个人脸的边界框信息。有些模型可以返回额外的人脸属性信息，如年龄、性别等。需要返回额外的信息字段用于存储这些属性。


#### 人脸特征提取模块
负责从检测到的人脸图像中提取高维特征向量，这些特征向量用于后续的人脸比对和识别。提取的特征向量应具有较强的区分能力和鲁棒性。


#### 人脸检索模块
负责在数据库中检索与输入人脸特征向量相似的人脸记录，返回匹配结果。支持多种相似度计算方法，如欧氏距离、余弦相似度等。


#### 存储模块
用于存储图片等数据，需要支持本地存储和云存储两种方式。存储模块应提供统一的接口，方便其他模块调用。












### 核心表结构

数据库使用 pg + pg_vector 存储人脸相关数据，主要包含以下核心表结构：


通用字段
- id: 主键，唯一标识一条记录。 uuid 类型
- created_at: 记录创建时间。
- updated_at: 记录最后更新时间。
- deleted_at: 软删除时间，记录被删除的时间戳，未删除则为 null。
- is_deleted: 软删除标志，布尔类型，标识记录是否被删除。


#### applications 表
- app_code : 应用编码，唯一标识一个应用。
- app_name: 应用名称。

#### faces 表

- app_id: 关联的应用 ID。
- feature_vector: 人脸特征向量，使用 pg_vector 存储。
- image_url: 人脸图像的存储路径或 URL。
- person_id: 关联的人员 ID。人脸服务器只记录id，不存储人员信息。
- metadata: json + gin 用于存储额外的元数据，调用方传入， 可以进行过滤




